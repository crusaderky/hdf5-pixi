[workspace]
channels = ["conda-forge"]
name = "hdf5-pixi"
platforms = ["linux-64", "linux-aarch64", "osx-64", "osx-arm64", "win-64"]
version = "0.1.0"

[activation.env]
NTHREADS = "4"
CONFIG = "Debug"
# CONFIG = "Developer"
# CONFIG = "Release"

[tasks]
clean = { cmd = "rm -rf build conda-bld" }

[feature.build.dependencies]
cmake = "*"
compilers = "*"
ninja = "*"
openjdk = "*"

[feature.build.tasks]
cmake-init = { cmd = "cmake -S hdf5 -B build" }
build = { cwd = "build", cmd = "cmake --build . --parallel $NTHREADS --config $CONFIG", depends-on = ["cmake-init"] }
test = { cwd = "build", cmd = "ctest --output-on-failure --parallel $NTHREADS --build-config $CONFIG" }
pack = { cwd = "build", cmd = "cpack -C $CONFIG -V" }

[feature.conda-build.dependencies]
boa = "*"
conda-build = "*"
conda-verify = "*"

[feature.conda-build.tasks]
conda-build = { cmd = "conda mambabuild recipe --output-folder conda-bld" }
conda-verify = { cmd = "conda-verify conda-bld/**/*.tar.bz2" }

[environments]
build = ["build"]
conda-build = ["conda-build"]
